{% extends "base.html" %}
{% load i18n %}
{% load static %}

{% block meta %}
    <meta property="og:url" content="https://www.r3tools.cc/en/tool/10/aws-amazon-smtp/">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Jammal Gold | {{ product.name }}">
    <meta property="og:description" content="{{ product.description|linebreaks }}">
    <meta property="og:image" content="{{ product.image_1.url }}">
{% endblock meta %}

{% block title %}
  {{ product.name }}
{% endblock %}

{% block content %}
<main class="container mt-4">
  <section class="row product-section">
    
    <!-- ✅ الصور - يسار -->
    <div class="col-lg-6 mb-4">
      <div class="position-relative border rounded shadow-sm overflow-hidden" style="max-height: 500px;">
        <img id="mainImage"
            src="{% if product.image_1 %}{{ product.image_1.url }}{% else %}{% static 'img/no_image.png' %}{% endif %}"
            alt="{{ product.name }}"
            class="img-fluid w-100 product-main-img"
            style="object-fit: contain; cursor: zoom-in;">
      </div>

      <!-- ✅ الصور المصغرة -->
      <div class="d-flex flex-wrap gap-2 mt-3">
        {% if product.image_1 %}
          <img src="{{ product.image_1.url }}" alt="Main"
              class="img-thumbnail thumb-image"
              style="width: 70px; height: 70px; cursor: pointer; object-fit: cover;">
        {% endif %}
        {% if product.image_2 %}
          <img src="{{ product.image_2.url }}" alt="Image 2"
              class="img-thumbnail thumb-image"
              style="width: 70px; height: 70px; cursor: pointer; object-fit: cover;">
        {% endif %}
        {% if product.image_3 %}
          <img src="{{ product.image_3.url }}" alt="Image 3"
              class="img-thumbnail thumb-image"
              style="width: 70px; height: 70px; cursor: pointer; object-fit: cover;">
        {% endif %}
        {% if product.image_4 %}
          <img src="{{ product.image_4.url }}" alt="Image 4"
              class="img-thumbnail thumb-image"
              style="width: 70px; height: 70px; cursor: pointer; object-fit: cover;">
        {% endif %}
      </div>
    </div> <!-- ⬅️ إغلاق عمود الصور هنا -->

    <!-- ✅ التفاصيل - يمين -->
    <div class="col-lg-6">
      <h2 class="fw-bold mb-2">{{ product.name }}</h2>
      <p class="text-muted mb-3">Brand: Luxe Threads | Style: Evening Gown | Color: Midnight Blue</p>

      {% if request.user.is_authenticated and request.user.is_vendor %}
        <p class="h4 text-success fw-bold mb-3">{% trans 'Price' %}: ${{ product.price_vendor }}</p>
      {% elif request.user.is_authenticated and not request.user.is_vendor %}
        <p class="h4 text-success fw-bold mb-3">{% trans 'Price' %}: ${{ product.price_customer }}</p>
      {% endif %}

      <p class="text-muted">{% trans 'Available Stock' %}: {{ product.stock }}</p>

      {% if request.user.is_authenticated %}
        <form class="mt-4" action="{% url 'cart:cart_add' product.id %}" method="post">
          {% csrf_token %}
          {{ cart_product_form }}
          <button class="btn-main fs-small px-3 py-2 mt-2">{% trans 'Add to Cart' %}</button>
        </form>
      {% else %}
        <p>{% trans 'login for more!' %}</p>
      {% endif %}
        
      <div class="mt-5">
        <h4 class="fw-semibold mb-2">{% trans 'Product Description' %}</h4>
        <p class="text-muted">{{ product.description }}</p>
      </div>

      <div class="mt-4">
        {% trans 'Category' %}:
        <a href="{{ product.category.get_absolute_url }}" class="text-decoration-none">
          {{ product.category }}
        </a>
      </div>
    </div>
  </section>

  <!-- ✅ المنتجات المشابهة -->
  {% if similar_products %}
  <div class="my-5">
    <h4 class="fw-bold mb-4 text-center">{% trans '✨ New Arrivals / You might also like' %}</h4>
    
    <div class="row row-cols-2 row-cols-md-4 g-4">
      {% for similar in similar_products %}
        <div class="col">
          <a href="{{ similar.get_absolute_url }}" class="text-decoration-none">
            <div class="card h-100 shadow-sm border-0 rounded-4 hover-card">
              
              <!-- صورة المنتج -->
              <div class="position-relative">
              <img src="{% if similar.image_1 %}{{ similar.image_1.url }}{% else %}{% static 'img/no_image.png' %}{% endif %}" 
                  alt="{{ similar.name }}" 
                  class="card-img-top rounded-top-4" 
                  style="height: 220px; object-fit: cover; width: 100%;">
              <span class="badge bg-success position-absolute top-0 end-0 m-2 px-3 py-2 fs-small shadow">New</span>
            </div>
            
            <!-- تفاصيل المنتج -->
            <div class="card-body text-center">
              <p class="dark-color-txt fw-semibold mb-1">{{ similar.name|truncatechars:35 }}</p>
              
              {% if request.user.is_authenticated and request.user.is_vendor %}
                <p class="text-success fw-bold mb-0">${{ similar.price_vendor }}</p>
              {% else %}
                <p class="text-success fw-bold mb-0">${{ similar.price_customer }}</p>
              {% endif %}
            </div>
          </div>
        </a>
      </div>
    {% empty %}
      <p class="dark-color-txt text-center">{% trans 'No similar product' %}</p>
    {% endfor %}
  </div>
</div>
{% endif %}
</main>

<!-- ✅ سلوك تغيير الصورة بالـ JavaScript -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const thumbnails = document.querySelectorAll(".thumb-image");
    const mainImage = document.getElementById("mainImage");

    thumbnails.forEach(thumb => {
      thumb.addEventListener("click", () => {
        mainImage.src = thumb.src;
        
        thumbnails.forEach(t => t.classList.remove("selected"));
        thumb.classList.add("selected");
      });
    });
  });
</script>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const thumbnails = document.querySelectorAll(".thumb-image");
  const mainImage = document.getElementById("mainImage");

  // ✅ تغيير الصورة عند الضغط على thumbnail
  thumbnails.forEach(thumb => {
    thumb.addEventListener("click", () => {
      mainImage.src = thumb.src;
      thumbnails.forEach(t => t.classList.remove("selected"));
      thumb.classList.add("selected");
    });
  });

  // ✅ Lightbox عند الضغط على الصورة الرئيسية
  mainImage.addEventListener("click", () => {
    const lightbox = document.createElement("div");
    lightbox.style.position = "fixed";
    lightbox.style.top = "0";
    lightbox.style.left = "0";
    lightbox.style.width = "100%";
    lightbox.style.height = "100%";
    lightbox.style.background = "rgba(0,0,0,0.9)";
    lightbox.style.display = "flex";
    lightbox.style.alignItems = "center";
    lightbox.style.justifyContent = "center";
    lightbox.style.cursor = "zoom-out";
    lightbox.innerHTML = `<img src="${mainImage.src}" style="max-width:90%; max-height:90%; border-radius: 10px;">`;

    document.body.appendChild(lightbox);

    lightbox.addEventListener("click", () => lightbox.remove());
  });
});
</script>

{% endblock %}
