{% extends "base.html" %}
{% load i18n %}
{% load static %}

{% block title %}
  {{ product.name }}
{% endblock %}

{% block content %}
<main class="container mt-4">

  <!-- ✅ سلايدر الصور -->
  <section class="mb-5">
    <div id="productCarousel" class="carousel slide" data-bs-ride="carousel">
      
      <!-- الصور الرئيسية -->
      <div class="carousel-inner border rounded shadow-sm">
        {% if product.image_1 %}
          <div class="carousel-item active">
            <img src="{{ product.image_1.url }}" class="d-block w-100 zoomable" alt="Image 1" style="object-fit: contain; max-height: 600px; cursor: zoom-in;" data-bs-toggle="modal" data-bs-target="#zoomModal" data-img="{{ product.image_1.url }}">
          </div>
        {% endif %}
        {% if product.image_2 %}
          <div class="carousel-item">
            <img src="{{ product.image_2.url }}" class="d-block w-100 zoomable" alt="Image 2" style="object-fit: contain; max-height: 600px; cursor: zoom-in;" data-bs-toggle="modal" data-bs-target="#zoomModal" data-img="{{ product.image_2.url }}">
          </div>
        {% endif %}
        {% if product.image_3 %}
          <div class="carousel-item">
            <img src="{{ product.image_3.url }}" class="d-block w-100 zoomable" alt="Image 3" style="object-fit: contain; max-height: 600px; cursor: zoom-in;" data-bs-toggle="modal" data-bs-target="#zoomModal" data-img="{{ product.image_3.url }}">
          </div>
        {% endif %}
        {% if product.image_4 %}
          <div class="carousel-item">
            <img src="{{ product.image_4.url }}" class="d-block w-100 zoomable" alt="Image 4" style="object-fit: contain; max-height: 600px; cursor: zoom-in;" data-bs-toggle="modal" data-bs-target="#zoomModal" data-img="{{ product.image_4.url }}">
          </div>
        {% endif %}
      </div>

      <!-- أزرار التنقل -->
      <button class="carousel-control-prev" type="button" data-bs-target="#productCarousel" data-bs-slide="prev">
        <span class="carousel-control-prev-icon"></span>
      </button>
      <button class="carousel-control-next" type="button" data-bs-target="#productCarousel" data-bs-slide="next">
        <span class="carousel-control-next-icon"></span>
      </button>
    </div>

    <!-- ✅ الصور المصغّرة مع سكرول جانبي للجوال -->
    <div class="thumbnail-container d-flex gap-2 mt-3">
      {% if product.image_1 %}
        <img src="{{ product.image_1.url }}" alt="Thumb 1" class="img-thumbnail thumb-img"
            data-bs-target="#productCarousel" data-bs-slide-to="0">
      {% endif %}
      {% if product.image_2 %}
        <img src="{{ product.image_2.url }}" alt="Thumb 2" class="img-thumbnail thumb-img"
            data-bs-target="#productCarousel" data-bs-slide-to="1">
      {% endif %}
      {% if product.image_3 %}
        <img src="{{ product.image_3.url }}" alt="Thumb 3" class="img-thumbnail thumb-img"
            data-bs-target="#productCarousel" data-bs-slide-to="2">
      {% endif %}
      {% if product.image_4 %}
        <img src="{{ product.image_4.url }}" alt="Thumb 4" class="img-thumbnail thumb-img"
            data-bs-target="#productCarousel" data-bs-slide-to="3">
      {% endif %}
    </div>

  </section>

  <!-- ✅ مودال للتكبير -->
  <div class="modal fade" id="zoomModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content bg-transparent border-0">
        <button type="button" class="btn-close ms-auto me-2 mt-2" data-bs-dismiss="modal" aria-label="Close"></button>
        <img id="zoomImage" src="" class="img-fluid rounded shadow-lg" alt="Zoomed Image">
      </div>
    </div>
  </div>

  <!-- ✅ تفاصيل المنتج -->
  <section class="product-details text-center text-md-start">
    <h2 class="fw-bold mb-2">{{ product.name }}</h2>
    <p class="text-muted mb-3">Brand: Luxe Threads | Style: Evening Gown | Color: Midnight Blue</p>

    {% if request.user.is_authenticated and request.user.is_vendor %}
      <p class="h4 text-success fw-bold mb-3">{% trans 'Price' %}: ${{ product.price_vendor }}</p>
    {% elif request.user.is_authenticated and not request.user.is_vendor %}
      <p class="h4 text-success fw-bold mb-3">{% trans 'Price' %}: ${{ product.price_customer }}</p>
    {% endif %}

    <p class="text-muted">{% trans 'Available Stock' %}: {{ product.stock }}</p>

    {% if request.user.is_authenticated %}
      <!-- <form class="mt-4" action="{% url 'cart:cart_add' product.id %}" method="post">
        {% csrf_token %}
        {{ cart_product_form }}
        <button class="btn-main fs-small px-4 py-2 mt-2">{% trans 'Add to Cart' %}</button>
      </form>  -->
      <form class="mt-4 d-flex align-items-center gap-3" action="{% url 'cart:cart_add' product.id %}" method="post">
          {% csrf_token %}

          <!-- صندوق الكمية -->
          <div class="quantity-container d-flex align-items-center">
              <button type="button" class="btn btn-outline-dark btn-quantity" onclick="changeQty(-1)">-</button>
              <input 
                  type="number" 
                  id="quantityInput" 
                  name="quantity" 
                  class="form-control quantity-input text-center mx-2" 
                  value="1" 
                  min="1" 
                  max="{{ product.stock }}">
              <button type="button" class="btn btn-outline-dark btn-quantity" onclick="changeQty(1)">+</button>
          </div>

          <input type="hidden" name="override" value="false">

          <!-- زر إضافة للسلة -->
          <button class="btn-main fs-small px-4 py-2">
              {% trans 'Add to Cart' %}
          </button>
      </form>


    {% else %}
      <p>{% trans 'login for more!' %}</p>
    {% endif %}

    <div class="mt-5">
      <h4 class="fw-semibold mb-2">{% trans 'Product Description' %}</h4>
      <p class="text-muted">{{ product.description }}</p>
    </div>

    <div class="mt-4">
      {% trans 'Category' %}:
      <a href="{{ product.category.get_absolute_url }}" class="text-decoration-none">
        {{ product.category }}
      </a>
    </div>
  </section>
</main>

<!-- ✅ سكربت لتغيير الصورة داخل المودال -->
<script>
  const zoomModal = document.getElementById('zoomModal');
  zoomModal.addEventListener('show.bs.modal', function (event) {
    let img = event.relatedTarget; 
    let src = img.getAttribute('data-img');
    document.getElementById('zoomImage').src = src;
  });
</script>
{% endblock %}

