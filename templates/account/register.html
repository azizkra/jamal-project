{% extends 'base.html' %}
{% load static %}
{% load i18n %}

{% block content %}
<div class="container d-flex justify-content-center align-items-center" style="min-height: 100vh;">
    <div class="row w-100 shadow-sm rounded-3 overflow-hidden" style="max-width: 900px;">
        
        <!-- جانب الصورة -->
        <div class="col-md-6 d-none d-md-block p-0">
            <img src="{% static 'images/new_arrivals/collect2.png' %}" alt="صورة جانبية" class="img-fluid h-100" style="object-fit: cover;">
        </div>

        <!-- نموذج التسجيل -->
        <div class="col-md-6 p-4 bg-white">
            <h3 class="mb-4 text-center" style="color: var(--color-black-dark); font-weight: 600;">إنشاء حساب جديد</h3>

            <form method="post" novalidate>
                {% csrf_token %}

                <!-- اسم المستخدم -->
                <div class="mb-3">
                    <label for="{{ form.username.id_for_label }}" class="form-label">{{ form.username.label }}</label>
                    {{ form.username }}
                    {% if form.username.errors %}
                        <div class="text-danger small mt-1">{{ form.username.errors.as_text|slice:"2:" }}</div>
                    {% endif %}
                </div>

                <!-- البريد -->
                <div class="mb-3">
                    <label for="{{ form.email.id_for_label }}" class="form-label">{{ form.email.label }}</label>
                    {{ form.email }}
                    {% if form.email.errors %}
                        <div class="text-danger small mt-1">{{ form.email.errors.as_text|slice:"2:" }}</div>
                    {% endif %}
                </div>

                <!-- هل أنت تاجر -->
                <div class="mb-3 form-check">
                    {{ form.is_vendor }}
                    <label for="{{ form.is_vendor.id_for_label }}" class="form-check-label">{{ form.is_vendor.label }}</label>
                    {% if form.is_vendor.errors %}
                        <div class="text-danger small mt-1">{{ form.is_vendor.errors.as_text|slice:"2:" }}</div>
                    {% endif %}
                </div>

                <!-- الرقم الضريبي -->
                <div class="mb-3" id="tax_number_field" style="display: none;">
                    <label for="{{ form.tax_number.id_for_label }}" class="form-label">{{ form.tax_number.label }}</label>
                    {{ form.tax_number }}
                    {% if form.tax_number.errors %}
                        <div class="text-danger small mt-1">{{ form.tax_number.errors.as_text|slice:"2:" }}</div>
                    {% endif %}
                </div>

                <!-- كلمة المرور -->
                <div class="mb-3">
                    <label for="{{ form.password1.id_for_label }}" class="form-label">{{ form.password1.label }}</label>
                    {{ form.password1 }}
                    {% if form.password1.errors %}
                        <div class="text-danger small mt-1">{{ form.password1.errors.as_text|slice:"2:" }}</div>
                    {% endif %}
                </div>

                <!-- تأكيد كلمة المرور -->
                <div class="mb-3">
                    <label for="{{ form.password2.id_for_label }}" class="form-label">{{ form.password2.label }}</label>
                    {{ form.password2 }}
                    {% if form.password2.errors %}
                        <div class="text-danger small mt-1">{{ form.password2.errors.as_text|slice:"2:" }}</div>
                    {% endif %}
                </div>

                <button type="submit" class="btn-main w-100 py-2">{% trans 'registration' %}</button>
            </form>

            {% if messages %}
                <div class="mt-3">
                    {% for message in messages %}
                        <div class="alert alert-danger py-2 px-3" role="alert" style="font-size: 0.9rem;">
                            {{ message }}
                        </div>
                    {% endfor %}
                </div>
            {% endif %}

            <div class="mt-4 text-center fs-small">
                <a href="{% url 'account:login' %}" class="text-decoration-none text-muted">{% trans 'Do you have an account? ' %} <strong>{% trans 'Log in ' %}</strong></a>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const isVendorCheckbox = document.getElementById("id_is_vendor");
        const taxNumberField = document.getElementById("tax_number_field");

        function toggleTaxField() {
            if (isVendorCheckbox.checked) {
                taxNumberField.style.display = "block";
            } else {
                taxNumberField.style.display = "none";
                document.getElementById("id_tax_number").value = '';
            }
        }

        if (isVendorCheckbox) {
            isVendorCheckbox.addEventListener("change", toggleTaxField);
            toggleTaxField();
        }
    });
</script>
{% endblock %}
