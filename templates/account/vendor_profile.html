{% extends 'base.html' %}
{% load i18n static %}

{% block content %}
<div class="container my-4">
    <!-- بطاقة البروفايل -->
    <div class="card shadow-lg border-0 mb-4" style="border-radius: 15px;">
        <div class="card-body d-flex flex-wrap align-items-center">
            <!-- صورة المستخدم -->
            <img src="{% static 'images/users/user1.png' %}" 
                 alt="Profile" 
                 class="rounded-circle me-3 mb-3 mb-md-0 img-fluid" 
                 style="width:80px; height:80px; object-fit:cover;">

            <!-- بيانات المستخدم -->
            <div class="flex-grow-1">
                <h5 class="mb-1 dark-color-txt">{{ user.username }}</h5>
                <p class=" mb-1 small dark-color-txt">{{ user.email }}</p>
                <span class="badge bg-primary">{{ user.is_vendor|yesno:"Vendor,Customer" }}</span>
            </div>

            <p class="dark-color-txt small mb-1">
                💵 {% trans 'Total' %}: ${{ item.get_cost }}
                <small class="text-muted">(+ {{ item.tax_amount }} {% trans "tax" %})</small>
            </p>

            <!-- زر تسجيل الخروج -->
            <form method="post" action="{% url 'account:account_logout' %}" class="d-inline">
                {% csrf_token %}
                <button type="submit" class="btn btn-outline-danger btn-sm">
                    <i class="bi bi-box-arrow-right"></i> {% trans "Logout" %}
                </button>
            </form>

        </div>
    </div>

    <!-- تبويبات -->
    <ul class="nav nav-tabs mb-3" id="profileTabs">
        <li class="nav-item">
            <a class="nav-link dark-color active" data-bs-toggle="tab" href="#orders">{% trans 'Orders' %}</a>
        </li>
        <li class="nav-item">
            <a class="nav-link dark-color" data-bs-toggle="tab" href="#settings">{% trans 'Settings' %}</a>
        </li>
    </ul>

    <!-- محتوى التبويبات -->
    <div class="tab-content">
        <!-- الطلبات -->
        <div class="tab-pane fade show active" id="orders">
            <div class="row">
                {% for item in purchased_products %}
                <div class="col-12 col-sm-6 col-lg-4 mb-4">
                    <div class="card shadow-sm border-0 h-100">
                        <img src="{{ item.product.image_1.url }}" 
                             class="card-img-top img-fluid" 
                             alt="{{ item.product.name }}" 
                             style="height: 200px; object-fit: cover;">
                        <div class="card-body">
                            <h6 class="fw-semibold dark-color-txt">{{ item.product.name }}</h6>
                            <p class="dark-color-txt small mb-1">🔸 {% trans 'Quantity' %}: {{ item.quantity }}</p>
                            <p class="dark-color-txt small mb-1">💵 {% trans 'Total' %}: ${{ item.get_cost }}</p>
                        </div>
                    </div>
                </div>
                {% empty %}
                <p class="text-center dark-color-txt">{% trans 'No orders yet.' %}</p>
                {% endfor %}
            </div>
        </div>

        <!-- الإعدادات -->
        <div class="tab-pane fade" id="settings">
            <h5 class="mb-3">{% trans 'Account Settings' %}</h5>
            <form method="post" action="{% url 'account:set_theme' %}" id="themeForm">
                {% csrf_token %}
                <div class="mb-3" style="max-width: 300px;">
                    <label class="form-label">{% trans 'Theme' %}</label>
                    <select class="form-select form-select-dark" id="themeSelect">
                        <option value="light" {% if user.theme_preference == 'light' %}selected{% endif %}>{% trans 'Light' %}</option>
                        <option value="dark" {% if user.theme_preference == 'dark' %}selected{% endif %}>{% trans 'Dark' %}</option>
                    </select>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
document.getElementById("themeSelect").addEventListener("change", function(){
    fetch("{% url 'account:set_theme' %}", {
        method: "POST",
        headers: {"Content-Type": "application/json", "X-CSRFToken": "{{ csrf_token }}"},
        body: JSON.stringify({theme: this.value})
    });
});
</script>
{% endblock %}
